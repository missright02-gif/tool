<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸¬é©— 2 (Unit 2 - å„ªåŒ–ç‰ˆ)</title>
  <style>
    :root {
      /* çµ±ä¸€èª¿æ•´ç‚ºç²¾ç·»è—è‰²ç³» */
      --primary-color:#43a047;
      --primary-hover: #2e7d32;
      --accent-color: #f0f7ff;
      --success-color: #27ae60;
      --error-color: #e74c3c;
      --text-dark: #333;
      --text-light: #7f8c8d;
      --shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    body { 
      margin: 0;
      padding: 20px; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      min-height: 100vh; 
      font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; 
      background-color: #f4f7f6; 
    }

    .quiz-container { 
      background: white; 
      width: 100%; 
      max-width: 650px; 
      padding: 40px 30px; 
      border-radius: 20px; 
      box-shadow: var(--shadow); 
      position: relative; 
    }

    h1 { text-align: center; color: var(--primary-color); font-size: 26px; }
    .progress { text-align: right; font-size: 14px; color: var(--text-light); margin-bottom: 10px; font-weight: bold; }

    .speak-btn { 
      background: #fff; 
      border: 2px solid var(--primary-color); 
      color: var(--primary-color); 
      border-radius: 50px; 
      padding: 8px 20px; 
      cursor: pointer; 
      margin-bottom: 20px; 
      transition: 0.3s; 
      font-weight: bold;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .speak-btn:hover { background: var(--primary-color); color: white; }

    .option { margin: 12px 0; border: 2px solid #eee; border-radius: 12px; transition: 0.2s; }
    .option:hover { border-color: var(--primary-color); background: var(--accent-color); }
    .option label { display: block; padding: 15px 20px; cursor: pointer; font-size: 1.1em; }

    .submit-btn { 
      width: 100%; 
      padding: 15px; 
      background: var(--primary-color); 
      color: white; 
      border: none; 
      border-radius: 10px; 
      font-size: 18px; 
      font-weight: bold;
      cursor: pointer; 
      margin-top: 20px; 
      transition: background 0.3s;
    }
    .submit-btn:hover:not(:disabled) { background: var(--primary-hover); }

    #explanation-box {
      display: none;
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-left: 5px solid var(--primary-color);
      border-radius: 5px;
      color: var(--text-dark);
      animation: fadeIn 0.5s;
      line-height: 1.6;
    }

    .timer-bar-container {
      width: 100%;
      height: 6px;
      background: #eee;
      margin-top: 15px;
      border-radius: 3px;
      display: none;
      overflow: hidden;
    }
    .timer-bar {
      height: 100%;
      background: var(--primary-color);
      width: 100%;
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes shrink { from { width: 100%; } to { width: 0%; } }
  </style>
</head>
<body>

<div class="quiz-container">
  <div id="quiz-content">
    <h1>æ¸¬é©— 2: åŸå¸‚äº¤é€šèˆ‡æŒ‡è·¯</h1>
    <div id="progress" class="progress"></div>
    <button class="speak-btn" onclick="speakQuestion()">ğŸ”Š Listen Question</button>
    <h2 id="question" style="font-size: 1.25rem; min-height: 3em;">Loading...</h2>
    <form id="quizForm"></form>
    
    <div id="result" style="text-align:center; font-size:1.2em; margin-top:15px; font-weight:bold;"></div>
    
    <div id="explanation-box"></div>
    
    <div class="timer-bar-container" id="timerContainer">
      <div class="timer-bar" id="timerBar"></div>
      <p style="text-align:center; font-size:12px; color:#999; margin-top:8px;">8 ç§’å¾Œè‡ªå‹•é€²å…¥ä¸‹ä¸€é¡Œï¼Œæˆ–é»æ“ŠæŒ‰éˆ•è·³é</p>
    </div>

    <button id="mainBtn" class="submit-btn" onclick="checkAnswer()">æäº¤ç­”æ¡ˆ</button>
  </div>
</div>

<script>
const questions = [
  { q: "Excuse me. Could you show me the way to the train ________?", a: "station", options: ["stop", "station", "stool", "stand"], exp: "<b>Train station</b> æ˜¯ç«è»Šç«™ã€‚å…¬è»Šç«™å¸¸ç”¨ bus stopï¼Œè¨ˆç¨‹è»Šæ’ç­è™•ç”¨ taxi standã€‚" },
  { q: "You have been so much ________ to me.", a: "helpful", options: ["hill", "height", "honor", "helpful"], exp: "<b>Helpful</b> æ˜¯å½¢å®¹è©ã€Œæœ‰å¹«åŠ©çš„ã€ã€‚é€™å¥è©±å¸¸ç”¨æ–¼æ„Ÿè¬å°æ–¹çš„æŒ‡å¼•ã€‚" },
  { q: "Excuse me. Could you show me the ________ to the department store?", a: "direction", options: ["direction", "dictionary", "dove", "drought"], exp: "<b>Direction</b> æ„ç‚ºã€Œæ–¹å‘ã€ã€‚Show me the direction æ˜¯å¸¸è¦‹çš„å•è·¯èªªæ³•ã€‚" },
  { q: "I hope that I can ________ New York one day.", a: "visit", options: ["victory", "voice", "visit", "vehicle"], exp: "<b>Visit</b> æ˜¯å‹•è©ã€Œé€ è¨ªã€ã€‚" },
  { q: "It will ________ over thirty minutes to get there.", a: "take", options: ["spend", "take", "cost", "pay"], exp: "<b>It takes + æ™‚é–“</b> æ˜¯å›ºå®šå¥å‹ã€‚Spend çš„ä¸»è©é€šå¸¸è¦æ˜¯ã€Œäººã€ã€‚" },
  { q: "Itâ€™s ________ cold here. Weâ€™d better not stay outside.", a: "pretty", options: ["great", "pretty", "visit", "direction"], exp: "åœ¨é€™è£¡ <b>pretty</b> æ˜¯å‰¯è©ï¼Œæ„æ€æ˜¯ã€Œç›¸ç•¶åœ° (very/quite)ã€ï¼Œè€Œéç¾éº—ã€‚" },
  { q: "How can I ________ there? I am a stranger here.", a: "get", options: ["get", "take", "do", "jump"], exp: "<b>Get there</b> æ˜¯æŠµé”æŸåœ°çš„å¸¸ç”¨å£èªæ–¹å¼ã€‚" },
  { q: "You should take a ________ across from the department store.", a: "subway", options: ["success", "substitute", "suggestion", "subway"], exp: "åœ¨ç´ç´„ï¼Œåœ°éµçš„è‹±æ–‡æ˜¯ <b>subway</b>ã€‚" },
  { q: "We should ________ the train and transfer to another bus.", a: "get off", options: ["take off", "get off", "jump out", "go off"], exp: "<b>Get off</b> æ˜¯å¾å¤§çœ¾é‹è¼¸å·¥å…·ä¸‹è»Šã€‚Take off å‰‡æ˜¯æŒ‡é£›æ©Ÿèµ·é£›æˆ–è„«è¡£æœã€‚" },
  { q: "This book is a ________ travel tool.", a: "helpful", options: ["help", "helpful", "holiday", "hallway"], exp: "é€™è£¡éœ€è¦å½¢å®¹è©ä¿®é£¾å·¥å…·ï¼Œæ•…é¸ <b>helpful</b> (æœ‰å¹«åŠ©çš„)ã€‚" }
];

let shuffled = [];
let current = 0;
let score = 0;
let timerTimeout;

function start() {
  shuffled = [...questions].sort(() => Math.random() - 0.5);
  load();
}

function load() {
  const qObj = shuffled[current];
  document.getElementById("progress").innerText = `Progress: ${current + 1} / ${shuffled.length}`;
  document.getElementById("question").innerText = qObj.q;
  document.getElementById("result").innerText = "";
  document.getElementById("explanation-box").style.display = "none";
  document.getElementById("timerContainer").style.display = "none";
  
  const mainBtn = document.getElementById("mainBtn");
  mainBtn.innerText = "æäº¤ç­”æ¡ˆ";
  mainBtn.onclick = checkAnswer;
  mainBtn.disabled = false;

  const form = document.getElementById("quizForm");
  form.innerHTML = "";
  [...qObj.options].sort(() => Math.random() - 0.5).forEach(opt => {
    form.innerHTML += `<div class="option"><label><input type="radio" name="ans" value="${opt}"> ${opt}</label></div>`;
  });
}

function checkAnswer() {
  const selected = document.querySelector('input[name="ans"]:checked');
  if (!selected) return alert("è«‹é¸æ“‡ä¸€å€‹ç­”æ¡ˆï¼");

  const qObj = shuffled[current];
  const isCorrect = selected.value === qObj.a;
  const resDiv = document.getElementById("result");
  const expDiv = document.getElementById("explanation-box");
  const mainBtn = document.getElementById("mainBtn");
  const timerBar = document.getElementById("timerBar");
  
  // åœæ­¢ç•¶å‰èªéŸ³
  window.speechSynthesis.cancel();

  if (isCorrect) {
    score++;
    resDiv.innerHTML = "<span style='color:var(--success-color);'>âœ… æ­£ç¢º (Correct)!</span>";
  } else {
    resDiv.innerHTML = `<span style='color:var(--error-color);'>âŒ éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${qObj.a}</span>`;
  }

  expDiv.innerHTML = `<strong>è©³ç´°æ­£è§£ï¼š</strong><br>${qObj.exp}`;
  expDiv.style.display = "block";

  // åˆ‡æ›æŒ‰éˆ•ç‚ºä¸‹ä¸€é¡Œ
  mainBtn.innerText = "ä¸‹ä¸€é¡Œ (Next)";
  mainBtn.onclick = () => {
    clearTimeout(timerTimeout);
    nextStep();
  };

  document.getElementById("timerContainer").style.display = "block";
  timerBar.style.animation = "none";
  timerBar.offsetHeight; 
  timerBar.style.animation = "shrink 8s linear forwards";

  timerTimeout = setTimeout(nextStep, 8000);
}

function nextStep() {
  current++;
  if (current < shuffled.length) load();
  else end();
}

function speakQuestion() {
  window.speechSynthesis.cancel();
  let textToSpeak = shuffled[current].q;
  
  // å„ªåŒ–ï¼šå¦‚æœå·²ç¶“é–‹äº†è§£æï¼Œå°±å”¸å‡ºå®Œæ•´åŒ…å«ç­”æ¡ˆçš„å¥å­
  if (document.getElementById("explanation-box").style.display === "block") {
    textToSpeak = textToSpeak.replace("________", shuffled[current].a);
  } else {
    textToSpeak = textToSpeak.replace("________", "blank");
  }

  const msg = new SpeechSynthesisUtterance(textToSpeak);
  msg.lang = 'en-US';
  msg.rate = 0.85;
  window.speechSynthesis.speak(msg);
}

function end() {
  clearTimeout(timerTimeout);
  const container = document.getElementById("quiz-content");
  container.innerHTML = `
    <h1>ğŸ‰ æ¸¬é©—å®Œæˆï¼</h1>
    <div style="text-align:center; padding: 20px 0;">
      <p style="font-size: 1.2em;">æ‚¨çš„å¾—åˆ†</p>
      <strong style="font-size: 3em; color: var(--primary-color);">${score} / ${shuffled.length}</strong>
      <p style="margin-top: 20px; color: #555;">${score >= 8 ? "ğŸ† å¤ªæ£’äº†ï¼å¦³å°äº¤é€šç”¨èªéå¸¸ç†Ÿæ‚‰ï¼" : "ğŸ“– ç¹¼çºŒåŠ æ²¹ï¼Œå¤šç·´ç¿’å¹¾æ¬¡æœƒæ›´æ£’ï¼"}</p>
    </div>
    <button class="submit-btn" onclick="location.reload()">é‡æ–°æŒ‘æˆ°</button>
  `;
}

window.onload = start;
</script>
</body>
</html>

